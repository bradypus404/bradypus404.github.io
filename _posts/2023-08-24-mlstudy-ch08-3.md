---
layout: post
title: "[ML Study]ch08-3 합성곱 신경망의 시각화"
subtitle: 혼자 공부하는 머신러닝+딥러닝 [8-3]
date: 2023-08-22 09:02:00 +0900
author: Hyeonsu
categories: [Deep Learning]
tags: [가중치 시각화, 특성 맵 시각화, 함수형 API]
---
<body>
    <img
    src="/assets/images/post/book_banner.jpg"
    align="right"
    width="20%"
    height="27.2%"
    />
    <br><br>
    <p>본 포스팅 한빛미디어의 <a href="https://product.kyobobook.co.kr/detail/S000001810330"><혼자공부하는 머신러닝+딥러닝(박해선 저)></a>를 요약 정리했습니다.</p>
</body>
<br>

### 1. 가중치 시각화
---------------------------

각 필터는 커널이라 부르는 가중치와 절편을 가지고 있는데 일반적으로 절편은 시각적으로 의미가 있지 않다.
<br>가중치는 입력 이미지의 2차원 영역에 적용되어 어떤 특징을 크게 두드러지게 표현하는 역할을 한다.

2절에서 best-cnn-model.h5 파일을 생성하고 불러와 이어서 학습해야 하고, model.layers를 통해 층을 확인한다.
<br>Conv2D, MaxPooling2D, Conv2D, MaxPooling2D, Flatten, Dense, Dropout, Dense 층으로 이루어진 것을 확인 할 수 있다.

layers 속성의 첫 번째 원소를 선택해 weigths의 첫 번째 원소(가중치)와 두 번째 원소(절편)의 크기를 출력해보면 
```pyhon
conv = model.layers[0]
print(conv.weights[0].shape, conv.weights[1].shape)
```
(3, 3, 1, 32)  (32, )와 같이 나타난다. 

<br>그리고 가중치 배열의 평균과 표준편차를 넘파이 mean()과 std() 메서드로 계산해보면 
```pyhon
conv_weights = conv.weights[0].numpy()
print(conv_weights.mean(), conv_weights.std())
```
가중치의 평균값은 0에 가깝고 표준편차는 0.27 정도이다. 
<br>이 값을 히스토그램으로 확인해보면 0을 중심으로 종 모양 분포를 띠고 있는 것을 알 수 있다.

이번에는 32개의 커널을 16개씩 두 줄에 출력해 보도록 해보자.
```pyhon
fig, axs = plt.subplots(2, 16, figsize=(15,2))
for i in range(2):
    for j in range(16):
        axs[i, j].imshow(conv_weights[:,:,0,i*16 + j], vmin=-0.5, vmax=0.5)
        axs[i, j].axis('off')
plt.show()
```
훈련하지 않은 빈 합성곱 신경망을 만들기 위해서 먼저 Sequential 클래스로 모델을 생성하고 Conv2D 층을 하나 추가한다.
<br>다음 이 층의 가중치를 no_training_conv 변수에 저장해 이번처럼 평균과 표준편차를 확인해본다.
```pyhon
no_training_weights = no_training_conv.weights[0].numpy()
print(no_training_weights.mean(), no_training_weights.std())
```
-0.010310263과 0.0773888으로 표준편차가 매우 작게 나타난다.
<br>히스토그램으로 확인해 보면 이전과 다르게 비교적 고른 분포를 볼 수 있다.
<br>그 이유는 텐서플로가 신경망의 가중치를 처음 초기화할 때 균등 분포에서 랜덤하게 값을 선택하기 때문이다.


### 2. 함수형 API
---------------------------



### 3. 특성 맵 시각화 
---------------------------